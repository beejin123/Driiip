<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <title>文章列表</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <link href="../../../../public/Megarden.ico" rel="shortcut icon"/>
        <link rel="stylesheet" href="../../../../extend/layui/css/layui.css">
        <script src="../../../../extend/layui/layui.js"></script>
        <script src="../../../../extend/layui/layui.all.js"></script>
    </head>
  <body>
    <table class="layui-table">
  <colgroup>
    <col width="150">
    <col width="200">
    <col>
  </colgroup>
  <thead>
    <tr>
      <th>标题</th>
      <th>缩略图</th>
      <th>作者</th>
      <th>状态</th>
      <th>关键字</th>
      <th>添加时间</th>
      <th>操作</th>
    </tr> 
  </thead>
  <tbody>
    {volist name='list' id='article'}
    <tr>
      <td><?php echo $article['title'];?></td>
      <td>
        <?php
            if ($article['thumb'] != '') {
              echo "<img onclick='dianji(this)' width='35' height='35' src=" . 'http://' . $_SERVER['HTTP_HOST'] . '/' . $article['thumb'] . ">";
            }
          ?>
          <button class="layui-btn layui-btn-xs layui-btn-danger" onclick='editImg(<?php echo $article['art_id'];?>)'>更换</button>
      </td>
      <td><?php echo $article['author'];?></td>
      <td>
        <?php 
          if($article['status']==1){
            echo "待发布";
          }else{
            echo "已发布";
          }
        ?>
      </td>
      <td><?php echo $article['keyword'];?></td>
      <td><?php echo $article['add_time'];?></td>
      <td>
          <a href="javascript:void(0);" onclick="fun(<?php echo $article['art_id'];?>)" class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit"><i class="layui-icon layui-icon-search"></i>查看</a>
          <a href="<?php echo 'http://' . $_SERVER['HTTP_HOST'] . '/index.php/admin/article/edit?id=' . $article['art_id'];?>" class="layui-btn layui-btn-warm layui-btn-xs" lay-event="edit"><i class="layui-icon layui-icon-edit"></i>编辑</a>
          <?php if($article['status']==1){ ?>
          <a onclick="return confirm(`确定发布吗？`)" href="<?php echo 'http://' . $_SERVER['HTTP_HOST'] . '/index.php/admin/article/send?status=2&id=' . $article['art_id'];?>" class="layui-btn layui-btn layui-btn-xs" lay-event="edit"><i class="layui-icon"></i>发布</a>
          <?php }?>
          <?php if($article['status']==2){ ?>
          <a onclick="return confirm(`确定发布吗？`)" href="<?php echo 'http://' . $_SERVER['HTTP_HOST'] . '/index.php/admin/article/send?status=1&id=' . $article['art_id'];?>" class="layui-btn layui-btn layui-btn-xs" lay-event="edit"><i class="layui-icon"></i>撤回</a>
          <?php }?>
          <a onclick="return confirm(`确定删除吗？`)" href="{:url('admin/article/del', ['id'=>$article['art_id']])}" class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i class="layui-icon layui-icon-delete"></i>删除</a>
        </td>
    </tr>
    {/volist}
  </tbody>
  <div id="show" style="display: none;margin-left: auto; margin-right: auto;width:113px;margin-top: 30px;">
    <button type="button" class="layui-btn" id="addImg">
      <i class="layui-icon">&#xe67c;</i>上传图片
    </button>
    <input type="hidden" id="art_id" name="art_id" value="">
  </div>
</table>
   <center>
      {$list|raw}
   </center>  
    </body>
    <script type="text/javascript">
      function editImg(data){
        var $ = layui.jquery;
        $("#art_id").val(data)
        layer.open({
          type: 1,
          title: '更换缩略图',
          area: ['200px', '160px'],
          content: $('#show'),
        });
      }
    </script>

    <script>
      layui.use('upload', function(){
        var upload = layui.upload;
         
        //执行实例
        var uploadInst = upload.render({
          elem: '#addImg'
          ,url: "{:url('admin/Article/editImg')}"
          ,data: {
              art_id: function(){
                  return document.getElementById("art_id").value
              },
          }
          ,done: function(res){
            if(res.code==200){
              layer.msg(res.message)
              setTimeout(function(){
                window.history.go(0)
              },2000);
            }else{
              layer.msg(res.message)
            }
          }
          ,error: function(){
            
          }
        });
      });
    </script>

    <script type="text/javascript">
      function fun(data){
        var str = "<?php echo 'http://' . $_SERVER['HTTP_HOST'] . '/index.php/index/index/detail/id/';?>" + data.toString() + '.html'
        layer.open({
          type: 2, 
          title: "文章详情",
          area: ['414px', '736px'],
          content: str
        }); 
      }

      function dianji(that){  
        var $ = layui.jquery;
        var image_url = $(that).attr("src");
        var image = new Image();
        image.src = image_url;
        var img;
        var width = 500*image.width/image.height; 
        img = "<img style='width:"+ width +"px;' src='" + $(that).attr("src") + "' />";
        layer.open({
              type: 1,
              shade: false,
              title: false,
              area:  [width+'px', '500px'],
              content: img, 
          });
      }
    </script>
</html>